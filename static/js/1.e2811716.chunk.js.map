{"version":3,"sources":["containers/video-player/components/controls/index.module.css","containers/video-player/components/controls/components/progress-bar/index.module.css","containers/video-player/index.module.css","containers/video-player/context/context-manager.ts","containers/video-player/components/hls/index.tsx","containers/video-player/components/video/index.tsx","containers/video-player/components/controls/components/progress-bar/index.tsx","containers/video-player/components/controls/components/play-button/index.tsx","containers/video-player/components/controls/components/mute-button/index.tsx","containers/video-player/components/controls/components/route-button/index.tsx","containers/video-player/components/controls/index.tsx","containers/video-player/context/utils.ts","containers/video-player/context/user-context.ts","containers/video-player/Child.tsx","containers/video-player/components/loading/index.tsx","containers/video-player/index.tsx","views/video/index.tsx"],"names":["module","exports","React","createContext","HLSSource","player","useContext","PlayerContext","videoRef","states","src","sourceType","initialized","playVideo","useCallback","hls","Hls","isSupported","current","loadSource","attachMedia","on","Events","ERROR","e","data","type","fatal","details","ErrorTypes","NETWORK_ERROR","console","log","MEDIA_ERROR","recoverMediaError","destroy","once","MANIFEST_PARSED","play","MEDIA_ATTACHED","useEffect","useMemo","Video","dispatch","onTimeUpdate","currentTime","target","onPlaying","custom","isLoading","onPlay","paused","onPause","onLoadedData","readyState","duration","onProgress","buffered","onWaiting","ref","controls","webkit-playsinline","playsInline","x5-video-player-type","style","width","getValue","rect","w","clientX","left","Math","round","ProgressBar","changeCurrentTime","pause","useState","value","setValue","slidRef","useRef","slidTrackRef","sliding","setSliding","updateRef","rectangleRef","trackTranslateX","toFixed","getTrackTranslateX","bufferedTranslateX","i","length","end","start","getBufferedEnd","getBufferedTranslateX","handClick","preventDefault","currentTarget","getBoundingClientRect","v","update","undefined","handTouchStart","c","touches","window","requestAnimationFrame","handTouchMove","handTouchEnd","className","styles","onClick","onTouchStart","onTouchMove","onTouchEnd","PlayButton","MuteButton","toggleMute","volume","RouteButton","VideoControls","SourceType","split","pop","Reducer","state","action","actions","json","_","omit","cloneDeep","Object","assign","DEFAULT_STATE","autoplay","playbackRate","UserContext","props","useReducer","lockPlay","el","promise","resetLock","then","video","changeRate","min","max","VideoPlayer","Provider","children","Loading","Child","VideoPage"],"mappings":"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","file":"static/js/1.e2811716.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"controls_container__yrgZO\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"slider\":\"progress-bar_slider__4qXsU\",\"slider_loading\":\"progress-bar_slider_loading__nBa8d\",\"slider_current\":\"progress-bar_slider_current__2PTdl\",\"slider_marker\":\"progress-bar_slider_marker__1JhlM\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"video-player_container__2uKDW\",\"video-container\":\"video-player_video-container__3sHGB\",\"operation\":\"video-player_operation__39MzM\",\"functional\":\"video-player_functional__3rLlY\"};","/*\n * @Author: Fullsize\n * @Date: 2021-09-16 11:04:49\n * @LastEditors: Fullsize\n * @LastEditTime: 2021-09-17 09:45:13\n * @FilePath: /react-context/src/containers/video-player/context/context-manager.ts\n */\nimport React from \"react\";\nimport { Player } from './type';\nexport default React.createContext<Player>({} as Player)","/* eslint-disable @typescript-eslint/no-unused-vars */\n/*\n * @Author: Fullsize\n * @Date: 2021-09-16 11:42:30\n * @LastEditors: Fullsize\n * @LastEditTime: 2021-09-16 15:21:09\n * @FilePath: /react-context/src/containers/video-player/components/hls/index.tsx\n */\nimport React, { useContext, useEffect, useMemo, useState, useCallback } from \"react\";\nimport PlayerContext from \"../../context/context-manager\";\nimport { Player } from \"../../context/type\";\nimport Hls from 'hls.js';\nlet currentSrc = ''\nconst createHls = (player: Player): Hls => {\n\t// const hls = new Hls({\n\t//   loader: Loader,\n\t// });\n\tconst hls = new Hls();\n\tconst video = player.videoRef && player.videoRef.current;\n\tconst source = player.states.src;\n\thls.on(Hls.Events.ERROR, (e, data) => {\n\t\t// const {\n\t\t//   attributeRef,\n\t\t//   controls: { sendNotification },\n\t\t//   listeners,\n\t\t// } = player;\n\t\tconst { type, fatal, details } = data;\n\t\tif (!fatal) return;\n\t\tif (type === Hls.ErrorTypes.NETWORK_ERROR) {\n\t\t\t// const { isChangingSource, changeLabel, onceNotify } = attributeRef.current;\n\t\t\t// if (isChangingSource) {\n\t\t\t//   attributeRef.current.isChangingSource = false;\n\t\t\t//   sendNotification(`请求失败，无法切换到${changeLabel}`);\n\t\t\t//   return;\n\t\t\t// }\n\t\t\tif (\n\t\t\t\tdetails === Hls.ErrorDetails.MANIFEST_LOAD_ERROR ||\n\t\t\t\tdetails === Hls.ErrorDetails.MANIFEST_LOAD_TIMEOUT\n\t\t\t) {\n\t\t\t\t// sendNotification('加载失败，试试切换线路', Infinity);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// if (!onceNotify) {\n\t\t\t//   sendNotification('播放卡顿，试试切换线路或清晰度', 20 * 1000);\n\t\t\t//   attributeRef.current.onceNotify = true;\n\t\t\t// }\n\t\t} else if (type === Hls.ErrorTypes.MEDIA_ERROR) {\n\t\t\thls.recoverMediaError();\n\t\t} else {\n\t\t\thls.destroy();\n\t\t\t// if (listeners.onError) {\n\t\t\t//   listeners.onError(\n\t\t\t//     {\n\t\t\t//       message: '播放器出错啦',\n\t\t\t//       data,\n\t\t\t//     },\n\t\t\t//     player\n\t\t\t//   );\n\t\t\t// }\n\t\t}\n\t});\n\thls.once(Hls.Events.MANIFEST_PARSED, () => {\n\t\tvideo?.play();\n\t});\n\thls.once(Hls.Events.MEDIA_ATTACHED, () => {\n\t\thls.loadSource(source);\n\n\t});\n\treturn hls;\n};\n\nconst HLSSource: React.FC = () => {\n\tconst player = useContext(PlayerContext);\n\tconst {\n\t\tvideoRef,\n\t\tstates: { src, sourceType = 'application/x-mpegURL', initialized },\n\t} = player;\n\tconst playVideo = useCallback(() => {\n\t\tconst hls = new Hls();\n\t\tif (Hls.isSupported()) {\n\t\t\tif (!videoRef.current) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\thls.loadSource(src);\n\t\t\thls.attachMedia(videoRef.current);\n\n\t\t\thls.on(Hls.Events.ERROR, (e, data) => {\n\t\t\t\tconst { type, fatal, details } = data;\n\t\t\t\tif (!fatal) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (type === Hls.ErrorTypes.NETWORK_ERROR) {\n\t\t\t\t\tconsole.log('网络错误');\n\t\t\t\t} else if (type === Hls.ErrorTypes.MEDIA_ERROR) {\n\t\t\t\t\thls.recoverMediaError();\n\t\t\t\t} else {\n\t\t\t\t\thls.destroy();\n\t\t\t\t}\n\t\t\t});\n\t\t\thls.once(Hls.Events.MANIFEST_PARSED, () => {\n\t\t\t\tvideoRef.current?.play();\n\t\t\t});\n\t\t\thls.once(Hls.Events.MEDIA_ATTACHED, () => {\n\t\t\t\thls.loadSource(src);\n\t\t\t});\n\t\t}\n\t}, [src, videoRef]);\n\tuseEffect(()=>{\tplayVideo()},[playVideo])\n\treturn useMemo(() => {\n\t\treturn initialized ? <source src={src} type={sourceType} /> : null;\n\t}, [initialized, sourceType, src])\n\n};\n\nexport default HLSSource;","/*\n * @Author: Fullsize\n * @Date: 2021-09-16 11:40:40\n * @LastEditors: Fullsize\n * @LastEditTime: 2021-09-24 18:01:44\n * @FilePath: /react-context/src/containers/video-player/components/video/index.tsx\n */\nimport React, { useCallback, useContext, useMemo } from \"react\";\nimport PlayerContext from \"../../context/context-manager\";\nimport HLSSource from \"../hls\";\nconst Video: React.FC = () => {\n\tconst player = useContext(PlayerContext);\n\tconst { states, videoRef, dispatch, } = player\n\tconst onTimeUpdate = useCallback((e) => {\n\t\tdispatch({ type: 'currentTime', currentTime: e.target.currentTime })\n\n\t}, [dispatch])\n\tconst onPlaying = useCallback((e) => {\n\t\tdispatch({type:'custom',custom:{isLoading:false}})\n\t}, [dispatch])\n\tconst onPlay = useCallback((e) => {\n\t\tconsole.log('onPlay', e)\n\t\tdispatch({ type: 'paused', paused: false })\n\t}, [dispatch])\n\tconst onPause = useCallback((e) => {\n\t\tconsole.log('onPause', e)\n\t\tdispatch({ type: 'paused', paused: true })\n\t}, [dispatch])\n\tconst onLoadedData = useCallback((e) => {\n\t\tconsole.log('LoadedData', videoRef.current?.readyState)\n\t\tdispatch({ type: 'duration', duration: e.target.duration })\n\t}, [dispatch, videoRef])\n\tconst onProgress = useCallback((e) => {\n\t\tconsole.log('onProgress', e.target.buffered)\n\t\tdispatch({ type: 'custom', 'custom': { buffered: e.target.buffered } })\n\t}, [dispatch])\n\tconst onWaiting=useCallback((e)=>{\n\t\tconsole.log('onWaiting')\n\t\tdispatch({type:'custom',custom:{isLoading:true}})\n\t},[dispatch])\n\treturn useMemo(() => {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<video\n\t\t\t\t\tref={videoRef}\n\t\t\t\t\tcontrols={false}\n\t\t\t\t\twebkit-playsinline=\"true\"\n\t\t\t\t\tplaysInline={true}\n\t\t\t\t\tx5-video-player-type='h5'\n\t\t\t\t\tstyle={{ 'width': states.width }}\n\t\t\t\t\tonTimeUpdate={onTimeUpdate}\n\t\t\t\t\tonPlay={onPlay}\n\t\t\t\t\tonPause={onPause}\n\t\t\t\t\tonPlaying={onPlaying}\n\t\t\t\t\tonProgress={onProgress}\n\t\t\t\t\tonLoadedData={onLoadedData}\n\t\t\t\t\tonWaiting={onWaiting}\n\t\t\t\t>\n\t\t\t\t\t{states.sourceType === '' && (<source src={states.src} />)}\n\t\t\t\t\t<HLSSource />\n\t\t\t\t</video>\n\t\t\t</>\n\t\t)\n\t}, [videoRef, states.width, states.sourceType, states.src, onTimeUpdate, onPlay, onPause, onPlaying, onProgress, onLoadedData, onWaiting])\n\n}\nexport default Video;","/*\n * @Author: Fullsize\n * @Date: 2021-09-17 10:15:29\n * @LastEditors: Fullsize\n * @LastEditTime: 2021-09-27 17:24:24\n * @FilePath: /react-context/src/containers/video-player/components/controls/components/progress-bar/index.tsx\n */\nimport React, { useCallback, useContext, useMemo, useState, useRef, useEffect } from \"react\";\nimport PlayerContext from \"../../../../context/context-manager\";\nimport styles from './index.module.css';\nconst getBufferedEnd = (currentTime: number, buffered: any) => {\n\tif (!buffered) {\n\t\treturn 0;\n\t}\n\tfor (let i = buffered.length - 1; i >= 0; i -= 1) {\n\t\tconst end = buffered.end(i);\n\t\tif (currentTime <= end && buffered.start(i) <= currentTime) {\n\t\t\treturn end;\n\t\t}\n\t}\n\treturn 0;\n};\n\nconst getBufferedTranslateX = ({ buffered, currentTime, sliding, duration }: any) => {\n\tif (duration <= 0 || sliding) {\n\t\treturn '-100%';\n\t}\n\tconst e = getBufferedEnd(currentTime, buffered);\n\treturn `${((100 * e) / duration).toFixed(1)}%`;\n};\nconst getTrackTranslateX = ({ duration, currentTime, value, sliding }: any) => {\n\tif (duration < 0) {\n\t\treturn '0';\n\t}\n\tif (duration === 0) {\n\t\treturn '-100%';\n\t}\n\treturn `${((100 * (sliding ? value : currentTime)) / duration).toFixed(1)}%`;\n};\n\nconst getValue = (e: any, rect: any, duration: number) => {\n\tconst w = e.clientX - rect.left;\n\tif (w <= 0) {\n\t\treturn 0;\n\t}\n\tif (w >= rect.width) {\n\t\treturn duration;\n\t}\n\treturn Math.round((duration * (e.clientX - rect.left)) / rect.width);\n};\n\nconst ProgressBar: React.FC = () => {\n\tconst player = useContext(PlayerContext);\n\tconst { states: { currentTime, duration, buffered }, controls: { changeCurrentTime, pause } } = player;\n\tconst [value, setValue] = useState(currentTime);\n\tconst slidRef = useRef<HTMLDivElement>(null)\n\tconst slidTrackRef = useRef<HTMLDivElement>(null)\n\tconst [sliding, setSliding] = useState(false);\n\tconst updateRef = useRef<any>(null);\n\tconst rectangleRef = useRef<any>(null);\n\tconst trackTranslateX = getTrackTranslateX({ currentTime, duration, value, sliding })\n\tconst bufferedTranslateX = getBufferedTranslateX({ buffered, currentTime, sliding, duration });\n\tconst handClick = useCallback((e: any) => {\n\t\te.preventDefault();\n\t\tconst rect = e.currentTarget.getBoundingClientRect();\n\t\tconst v = getValue(e, rect, duration);\n\t\tsetValue(v)\n\t\tchangeCurrentTime(v)\n\t\tsetSliding(false);\n\t\tconsole.log('click',v)\n\t}, [changeCurrentTime, duration])\n\tconst update = useCallback(() => {\n\t\tif (!updateRef || !updateRef.current) {\n\t\t\treturn;\n\t\t}\n\t\tif (undefined !== updateRef.current.value) {\n\t\t\tsetValue(updateRef.current.value);\n\t\t}\n\t\tupdateRef.current = null;\n\t}, []);\n\tconst handTouchStart = useCallback((e) => {\n\t\tvar c = e.touches[0];\n\t\tif (slidRef.current) {\n\t\t\tconst { left, width } = slidRef.current.getBoundingClientRect();\n\t\t\trectangleRef.current = { left, width }\n\t\t}\n\t\tconst v = getValue(c, rectangleRef.current, duration);\n\t\tif (updateRef.current) {\n\t\t\tupdateRef.current.value = v;\n\t\t} else {\n\t\t\tupdateRef.current = { value: v };\n\t\t\twindow.requestAnimationFrame(update);\n\t\t}\n\t}, [duration, update])\n\tconst handTouchMove = useCallback((e) => {\n\t\tvar c = e.touches[0];\n\t\tif (!rectangleRef || !rectangleRef.current || !updateRef) {\n\t\t\treturn;\n\t\t}\n\t\tif (slidRef.current) {\n\t\t\tconst { left, width } = slidRef.current.getBoundingClientRect();\n\t\t\trectangleRef.current = { left, width }\n\t\t}\n\t\tconst v = getValue(c, rectangleRef.current, duration);\n\t\tpause()\n\t\tsetSliding(true)\n\t\tif (updateRef.current) {\n\t\t\tupdateRef.current.value = v;\n\t\t} else {\n\t\t\tupdateRef.current = { value: v };\n\t\t\twindow.requestAnimationFrame(update);\n\t\t}\n\t}, [duration, pause, update])\n\tuseEffect(()=>{\n\t\tsetSliding(false)\n\t},[currentTime])\n\tconst handTouchEnd = useCallback((e) => {\n\t\te.preventDefault();\n\t\tupdate();\n\t\tconsole.log('handTouchEnd',value,e)\n\t\tchangeCurrentTime(value)\n\t\n\t}, [changeCurrentTime, update, value])\n\n\treturn useMemo(() => {\n\t\treturn (\n\t\t\t<div className={styles['slider']} ref={slidRef} onClick={handClick}>\n\t\t\t\t{/* 加载条 */}\n\t\t\t\t<div\n\t\t\t\t\tclassName={styles['slider_loading']}\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\t'width': `${bufferedTranslateX}`\n\t\t\t\t\t}}>\n\t\t\t\t</div>\n\t\t\t\t{/* 进度条 */}\n\t\t\t\t<div\n\t\t\t\t\tclassName={styles['slider_current']}\n\t\t\t\t\tref={slidTrackRef}\n\t\t\t\t\tonTouchStart={handTouchStart}\n\t\t\t\t\tonTouchMove={handTouchMove}\n\t\t\t\t\tonTouchEnd={handTouchEnd}\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\t'width': `${trackTranslateX}`\n\t\t\t\t\t}}>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t)\n\t}, [bufferedTranslateX, handClick, handTouchEnd, handTouchMove, handTouchStart, trackTranslateX])\n\n}\nexport default ProgressBar;","/*\n * @Author: Fullsize\n * @Date: 2021-09-17 11:36:28\n * @LastEditors: Fullsize\n * @LastEditTime: 2021-09-17 12:01:53\n * @FilePath: /react-context/src/containers/video-player/components/controls/components/play-button/index.tsx\n */\nimport React, { useContext, useMemo } from \"react\";\nimport PlayerContext from \"../../../../context/context-manager\";\nconst PlayButton: React.FC = () => {\n\tconst player = useContext(PlayerContext);\n\tconst { states: { paused }, controls } = player;\n\treturn useMemo(() => {\n\t\treturn (\n\t\t\t<>\n\t\t\t\t{paused && <button onClick={controls.play}>播放</button>}\n\t\t\t\t{!paused && <button onClick={controls.pause}>暂停</button>}\n\t\t\t</>\n\t\t)\n\t}, [controls.pause, controls.play, paused])\n\n}\nexport default PlayButton;","/*\n * @Author: Fullsize\n * @Date: 2021-09-23 10:03:47\n * @LastEditors: Fullsize\n * @LastEditTime: 2021-09-27 17:24:30\n * @FilePath: /react-context/src/containers/video-player/components/controls/components/mute-button/index.tsx\n */\nimport React, { useContext } from \"react\";\nimport PlayerContext from \"../../../../context/context-manager\";\nconst MuteButton: React.FC = () => {\n\tconst play = useContext(PlayerContext);\n\tconst { videoRef, controls: { toggleMute } } = play;\n\treturn (\n\t\t<>\n\t\t\t{!!videoRef.current?.volume && (<button onClick={toggleMute}>静音</button>)}\n\t\t\t{!!!videoRef.current?.volume && (<button onClick={toggleMute}>声音</button>)}\n\t\t</>\n\t)\n\n}\nexport default MuteButton;\n","/*\n * @Author: Fullsize\n * @Date: 2021-09-24 15:52:06\n * @LastEditors: Fullsize\n * @LastEditTime: 2021-09-24 15:54:54\n * @FilePath: /react-context/src/containers/video-player/components/controls/components/route-button/index.tsx\n */\nimport React from \"react\";\nconst RouteButton: React.FC = () => {\n\treturn (\n\t\t<button>线路</button>\n\t)\n}\nexport default RouteButton;","/*\n * @Author: Fullsize\n * @Date: 2021-09-17 10:12:01\n * @LastEditors: Fullsize\n * @LastEditTime: 2021-09-24 16:12:18\n * @FilePath: /react-context/src/containers/video-player/components/controls/index.tsx\n */\nimport React from \"react\";\nimport styles from './index.module.css';\nimport ProgressBar from './components/progress-bar'\nimport PlayButton from './components/play-button';\nimport MuteButton from './components/mute-button';\nimport RouteButton from './components/route-button'\nconst VideoControls = () => {\n\treturn (\n\t\t<div className={styles['container']}>\n\t\t\t<ProgressBar />\n\t\t\t<div>\n\t\t\t\t<PlayButton />\n\t\t\t\t<MuteButton />\n\t\t\t\t<RouteButton />\n\t\t\t</div>\n\t\t</div>\n\t)\n}\nexport default VideoControls;","/*\n * @Author: Fullsize\n * @Date: 2021-09-16 11:46:56\n * @LastEditors: Fullsize\n * @LastEditTime: 2021-09-16 11:50:59\n * @FilePath: /react-context/src/containers/video-player/context/utils.ts\n */\nexport function SourceType(src: string): string {\n\tconst originSrc = src.split('?')[0];\n\tconst fileType = originSrc.split('.').pop();\n\tlet sourceType = '';\n\tswitch (fileType) {\n\t\tcase 'm3u8':\n\t\t\tsourceType = 'application/x-mpegUrl';\n\t\t\tbreak;\n\t\tcase 'flv':\n\t\t\tsourceType = 'video/x-flv';\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tsourceType = '';\n\t}\n\treturn sourceType;\n}","/* eslint-disable react-hooks/exhaustive-deps */\n/*\n * @Author: Fullsize\n * @Date: 2021-09-16 11:08:28\n * @LastEditors: Fullsize\n * @LastEditTime: 2021-09-27 17:28:56\n * @FilePath: /react-context/src/containers/video-player/context/user-context.ts\n */\nimport { useCallback, useReducer, useRef } from \"react\";\nimport _ from 'lodash';\nimport { StateType, DispatchAction, Player, VideoControls } from './type';\nimport { SourceType } from './utils';\nimport { PropsType } from '../type';\nconst Reducer = (state: StateType, action: DispatchAction) => {\n\tconst actions = action.type === 'custom' ? action.custom : action\n\tconst json = _.omit(_.cloneDeep(actions), ['type'])\n\treturn Object.assign({}, state, json)\n}\nconst DEFAULT_STATE: StateType = {\n\twidth: '100%',\n\tcurrentTime: 0,\n\tsrc: 'https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8',\n\tautoplay: false,\n\tsourceType: 'application/x-mpegURL',\n\tinitialized: true,\n\tplaybackRate: 1.0,\n\tduration: 0,\n\tpaused: true,\n\tbuffered: null,\n\tisLoading:false,\n}\nexport default function UserContext(props?: PropsType): Player {\n\tconst videoRef = useRef<HTMLVideoElement>(null);\n\tconst [states, dispatch] = useReducer(Reducer, {\n\t\t...DEFAULT_STATE,\n\t\tsrc: props?.src || DEFAULT_STATE.src,\n\t\tsourceType: SourceType(props?.src || DEFAULT_STATE.src),\n\t});\n\t// video controls\n\tlet lockPlay = false;\n\tconst play = useCallback(() => {\n\t\tconst el = videoRef && videoRef.current;\n\t\tif (!el) {\n\t\t\treturn undefined;\n\t\t}\n\t\tif (!lockPlay) {\n\t\t\tconst promise = el.play();\n\t\t\tconst isPromise = typeof promise === 'object';\n\t\t\tif (isPromise) {\n\t\t\t\tlockPlay = true;\n\t\t\t\tconst resetLock = (): void => {\n\t\t\t\t\tlockPlay = false;\n\t\t\t\t};\n\t\t\t\tpromise.then(resetLock, resetLock);\n\t\t\t}\n\t\t\treturn promise;\n\t\t}\n\t\treturn undefined;\n\t}, []);\n\tconst pause = useCallback(() => {\n\t\tconst el = videoRef && videoRef.current;\n\t\tif (el && !lockPlay) {\n\t\t\tel.pause();\n\t\t}\n\t}, [lockPlay]);\n\n\t// 音量\n\tconst toggleMute = useCallback(() => {\n\t\tconst MIN_VOLUME = 0;\n\t\tconst VOLUME = 0.5;\n\t\tconst video = videoRef && videoRef.current;\n\t\tif (!video) return;\n\t\tvideo.volume = video.volume ? MIN_VOLUME : VOLUME;\n\t}, []);\n\n\t// 切换倍速\n\tconst changeRate = useCallback((playbackRate: number) => {\n\t\tconst el = videoRef && videoRef.current;\n\t\tif (!el) {\n\t\t\treturn;\n\t\t}\n\t\tel.playbackRate = playbackRate;\n\t}, []);\n\n\tconst changeCurrentTime = useCallback((currentTime: number) => {\n\t\tconst el = videoRef && videoRef.current;\n\t\tif (!el || el.duration === undefined) {\n\t\t\treturn;\n\t\t}\n\t\tel.currentTime = Math.min(el.duration, Math.max(0, currentTime));\n\t\tconsole.log(220220220, el.currentTime);\n\t\tif (el.paused) {\n\t\t\tel.play();\n\t\t}\n\t}, [])\n\tconst controls: VideoControls = {\n\t\tplay,\n\t\tpause,\n\t\ttoggleMute,\n\t\tchangeRate,\n\t\tchangeCurrentTime\n\t}\n\treturn {\n\t\tstates,\n\t\tdispatch,\n\t\tprops,\n\t\tvideoRef,\n\t\tcontrols\n\t}\n}","/*\n * @Author: Fullsize\n * @Date: 2021-09-16 10:58:34\n * @LastEditors: Fullsize\n * @LastEditTime: 2021-09-16 15:28:26\n * @FilePath: /react-context/src/containers/video-player/contextChild.tsx\n */\nimport React from \"react\";\nimport PlayerContext from \"./context/context-manager\";\nimport UserContext from './context/user-context';\nimport { PropsType } from './type';\nconst VideoPlayer: React.FC<PropsType>= (props) => {\n\treturn (\n\t\t<PlayerContext.Provider value={UserContext()}>\n\t\t\t{props.children}\n\t\t</PlayerContext.Provider>\n\t)\n}\nexport default VideoPlayer;","/*\n * @Author: Fullsize\n * @Date: 2021-09-24 16:41:20\n * @LastEditors: Fullsize\n * @LastEditTime: 2021-09-24 17:45:25\n * @FilePath: /react-context/src/containers/video-player/components/loading/index.tsx\n */\nimport React, { useContext } from \"react\";\nimport PlayerContext from \"../../context/context-manager\";\nconst Loading: React.FC = () => {\n\tconst player = useContext(PlayerContext);\n\tconst { states } = player;\n\treturn (\n\t\t<>\n\t\t\t{states.isLoading && <div>loading...</div>}\n\t\t</>\n\n\t)\n}\nexport default Loading;","/*\n * @Author: Fullsize\n * @Date: 2021-09-16 10:58:34\n * @LastEditors: Fullsize\n * @LastEditTime: 2021-09-24 17:33:15\n * @FilePath: /react-context/src/containers/video-player/index.tsx\n */\nimport React from \"react\";\nimport { PropsType } from './type';\nimport Video from './components/video';\nimport VideoControls from './components/controls'\nimport Child from \"./Child\";\nimport Loading from \"./components/loading\";\nimport styles from './index.module.css';\nconst VideoPlayer: React.FC<PropsType> = (props) => {\n\treturn (\n\t\t<Child {...props}>\n\t\t\t<div className={styles['container']}>\n\t\t\t\t<div className={styles['video-container']}>\n\t\t\t\t\t<Video />\n\t\t\t\t</div>\n\t\t\t\t<div className={styles['operation']}>\n\t\t\t\t\t<div className={styles['functional']}>\n\t\t\t\t\t\t<Loading />\n\t\t\t\t\t</div>\n\t\t\t\t\t<VideoControls />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Child>\n\t)\n}\nexport default VideoPlayer;","/*\n * @Author: Fullsize\n * @Date: 2021-09-16 10:57:33\n * @LastEditors: Fullsize\n * @LastEditTime: 2021-09-16 15:26:34\n * @FilePath: /react-context/src/views/video/index.tsx\n */\nimport React from 'react';\nimport Player from '../../containers/video-player';\nconst VideoPage=()=>{\n\treturn(\n\t\t<>\n\t\t\t<Player src=''  />\n\t\t</>\n\t)\n}\nexport default VideoPage;"],"sourceRoot":""}