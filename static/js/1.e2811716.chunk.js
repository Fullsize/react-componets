(this["webpackJsonpreact-context"]=this["webpackJsonpreact-context"]||[]).push([[1],{65:function(e,t,n){e.exports={container:"controls_container__yrgZO"}},66:function(e,t,n){e.exports={slider:"progress-bar_slider__4qXsU",slider_loading:"progress-bar_slider_loading__nBa8d",slider_current:"progress-bar_slider_current__2PTdl",slider_marker:"progress-bar_slider_marker__1JhlM"}},69:function(e,t,n){e.exports={container:"video-player_container__2uKDW","video-container":"video-player_video-container__3sHGB",operation:"video-player_operation__39MzM",functional:"video-player_functional__3rLlY"}},8:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),a=n(54),u=c.a.createContext({}),o=n(64),i=n.n(o),s=n(2),l=function(){var e=Object(r.useContext)(u),t=e.videoRef,n=e.states,c=n.src,a=n.sourceType,o=void 0===a?"application/x-mpegURL":a,l=n.initialized,d=Object(r.useCallback)((function(){var e=new i.a;if(i.a.isSupported()){if(!t.current)return!1;e.loadSource(c),e.attachMedia(t.current),e.on(i.a.Events.ERROR,(function(t,n){var r=n.type,c=n.fatal;n.details;c&&(r===i.a.ErrorTypes.NETWORK_ERROR?console.log("\u7f51\u7edc\u9519\u8bef"):r===i.a.ErrorTypes.MEDIA_ERROR?e.recoverMediaError():e.destroy())})),e.once(i.a.Events.MANIFEST_PARSED,(function(){var e;null===(e=t.current)||void 0===e||e.play()})),e.once(i.a.Events.MEDIA_ATTACHED,(function(){e.loadSource(c)}))}}),[c,t]);return Object(r.useEffect)((function(){d()}),[d]),Object(r.useMemo)((function(){return l?Object(s.jsx)("source",{src:c,type:o}):null}),[l,o,c])},d=function(){var e=Object(r.useContext)(u),t=e.states,n=e.videoRef,c=e.dispatch,a=Object(r.useCallback)((function(e){c({type:"currentTime",currentTime:e.target.currentTime})}),[c]),o=Object(r.useCallback)((function(e){c({type:"custom",custom:{isLoading:!1}})}),[c]),i=Object(r.useCallback)((function(e){console.log("onPlay",e),c({type:"paused",paused:!1})}),[c]),d=Object(r.useCallback)((function(e){console.log("onPause",e),c({type:"paused",paused:!0})}),[c]),b=Object(r.useCallback)((function(e){var t;console.log("LoadedData",null===(t=n.current)||void 0===t?void 0:t.readyState),c({type:"duration",duration:e.target.duration})}),[c,n]),j=Object(r.useCallback)((function(e){console.log("onProgress",e.target.buffered),c({type:"custom",custom:{buffered:e.target.buffered}})}),[c]),f=Object(r.useCallback)((function(e){console.log("onWaiting"),c({type:"custom",custom:{isLoading:!0}})}),[c]);return Object(r.useMemo)((function(){return Object(s.jsx)(s.Fragment,{children:Object(s.jsxs)("video",{ref:n,controls:!1,"webkit-playsinline":"true",playsInline:!0,"x5-video-player-type":"h5",style:{width:t.width},onTimeUpdate:a,onPlay:i,onPause:d,onPlaying:o,onProgress:j,onLoadedData:b,onWaiting:f,children:[""===t.sourceType&&Object(s.jsx)("source",{src:t.src}),Object(s.jsx)(l,{})]})})}),[n,t.width,t.sourceType,t.src,a,i,d,o,j,b,f])},b=n(65),j=n.n(b),f=n(47),v=n(66),p=n.n(v),O=function(e,t,n){var r=e.clientX-t.left;return r<=0?0:r>=t.width?n:Math.round(n*(e.clientX-t.left)/t.width)},h=function(){var e=Object(r.useContext)(u),t=e.states,n=t.currentTime,c=t.duration,a=t.buffered,o=e.controls,i=o.changeCurrentTime,l=o.pause,d=Object(r.useState)(n),b=Object(f.a)(d,2),j=b[0],v=b[1],h=Object(r.useRef)(null),g=Object(r.useRef)(null),m=Object(r.useState)(!1),x=Object(f.a)(m,2),y=x[0],_=x[1],C=Object(r.useRef)(null),k=Object(r.useRef)(null),T=function(e){var t=e.duration,n=e.currentTime,r=e.value,c=e.sliding;return t<0?"0":0===t?"-100%":"".concat((100*(c?r:n)/t).toFixed(1),"%")}({currentTime:n,duration:c,value:j,sliding:y}),R=function(e){var t=e.buffered,n=e.currentTime,r=e.sliding,c=e.duration;if(c<=0||r)return"-100%";var a=function(e,t){if(!t)return 0;for(var n=t.length-1;n>=0;n-=1){var r=t.end(n);if(e<=r&&t.start(n)<=e)return r}return 0}(n,t);return"".concat((100*a/c).toFixed(1),"%")}({buffered:a,currentTime:n,sliding:y,duration:c}),w=Object(r.useCallback)((function(e){e.preventDefault();var t=e.currentTarget.getBoundingClientRect(),n=O(e,t,c);v(n),i(n),_(!1),console.log("click",n)}),[i,c]),E=Object(r.useCallback)((function(){C&&C.current&&(void 0!==C.current.value&&v(C.current.value),C.current=null)}),[]),M=Object(r.useCallback)((function(e){var t=e.touches[0];if(h.current){var n=h.current.getBoundingClientRect(),r=n.left,a=n.width;k.current={left:r,width:a}}var u=O(t,k.current,c);C.current?C.current.value=u:(C.current={value:u},window.requestAnimationFrame(E))}),[c,E]),D=Object(r.useCallback)((function(e){var t=e.touches[0];if(k&&k.current&&C){if(h.current){var n=h.current.getBoundingClientRect(),r=n.left,a=n.width;k.current={left:r,width:a}}var u=O(t,k.current,c);l(),_(!0),C.current?C.current.value=u:(C.current={value:u},window.requestAnimationFrame(E))}}),[c,l,E]);Object(r.useEffect)((function(){_(!1)}),[n]);var F=Object(r.useCallback)((function(e){e.preventDefault(),E(),console.log("handTouchEnd",j,e),i(j)}),[i,E,j]);return Object(r.useMemo)((function(){return Object(s.jsxs)("div",{className:p.a.slider,ref:h,onClick:w,children:[Object(s.jsx)("div",{className:p.a.slider_loading,style:{width:"".concat(R)}}),Object(s.jsx)("div",{className:p.a.slider_current,ref:g,onTouchStart:M,onTouchMove:D,onTouchEnd:F,style:{width:"".concat(T)}})]})}),[R,w,F,D,M,T])},g=function(){var e=Object(r.useContext)(u),t=e.states.paused,n=e.controls;return Object(r.useMemo)((function(){return Object(s.jsxs)(s.Fragment,{children:[t&&Object(s.jsx)("button",{onClick:n.play,children:"\u64ad\u653e"}),!t&&Object(s.jsx)("button",{onClick:n.pause,children:"\u6682\u505c"})]})}),[n.pause,n.play,t])},m=function(){var e,t,n=Object(r.useContext)(u),c=n.videoRef,a=n.controls.toggleMute;return Object(s.jsxs)(s.Fragment,{children:[!!(null===(e=c.current)||void 0===e?void 0:e.volume)&&Object(s.jsx)("button",{onClick:a,children:"\u9759\u97f3"}),!(null===(t=c.current)||void 0===t?void 0:t.volume)&&Object(s.jsx)("button",{onClick:a,children:"\u58f0\u97f3"})]})},x=function(){return Object(s.jsx)("button",{children:"\u7ebf\u8def"})},y=function(){return Object(s.jsxs)("div",{className:j.a.container,children:[Object(s.jsx)(h,{}),Object(s.jsxs)("div",{children:[Object(s.jsx)(g,{}),Object(s.jsx)(m,{}),Object(s.jsx)(x,{})]})]})},_=n(67),C=n.n(_);function k(e){var t="";switch(e.split("?")[0].split(".").pop()){case"m3u8":t="application/x-mpegUrl";break;case"flv":t="video/x-flv";break;default:t=""}return t}var T=function(e,t){var n="custom"===t.type?t.custom:t,r=C.a.omit(C.a.cloneDeep(n),["type"]);return Object.assign({},e,r)},R={width:"100%",currentTime:0,src:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",autoplay:!1,sourceType:"application/x-mpegURL",initialized:!0,playbackRate:1,duration:0,paused:!0,buffered:null,isLoading:!1};function w(e){var t=Object(r.useRef)(null),n=Object(r.useReducer)(T,Object(a.a)(Object(a.a)({},R),{},{src:(null===e||void 0===e?void 0:e.src)||R.src,sourceType:k((null===e||void 0===e?void 0:e.src)||R.src)})),c=Object(f.a)(n,2),u=c[0],o=c[1],i=!1,s=Object(r.useCallback)((function(){var e=t&&t.current;if(e&&!i){var n=e.play();if("object"===typeof n){i=!0;var r=function(){i=!1};n.then(r,r)}return n}}),[]),l=Object(r.useCallback)((function(){var e=t&&t.current;e&&!i&&e.pause()}),[i]),d=Object(r.useCallback)((function(){var e=t&&t.current;e&&(e.volume=e.volume?0:.5)}),[]),b=Object(r.useCallback)((function(e){var n=t&&t.current;n&&(n.playbackRate=e)}),[]),j=Object(r.useCallback)((function(e){var n=t&&t.current;n&&void 0!==n.duration&&(n.currentTime=Math.min(n.duration,Math.max(0,e)),console.log(220220220,n.currentTime),n.paused&&n.play())}),[]);return{states:u,dispatch:o,props:e,videoRef:t,controls:{play:s,pause:l,toggleMute:d,changeRate:b,changeCurrentTime:j}}}var E=function(e){return Object(s.jsx)(u.Provider,{value:w(),children:e.children})},M=function(){var e=Object(r.useContext)(u).states;return Object(s.jsx)(s.Fragment,{children:e.isLoading&&Object(s.jsx)("div",{children:"loading..."})})},D=n(69),F=n.n(D),N=function(e){return Object(s.jsx)(E,Object(a.a)(Object(a.a)({},e),{},{children:Object(s.jsxs)("div",{className:F.a.container,children:[Object(s.jsx)("div",{className:F.a["video-container"],children:Object(s.jsx)(d,{})}),Object(s.jsxs)("div",{className:F.a.operation,children:[Object(s.jsx)("div",{className:F.a.functional,children:Object(s.jsx)(M,{})}),Object(s.jsx)(y,{})]})]})}))};t.default=function(){return Object(s.jsx)(s.Fragment,{children:Object(s.jsx)(N,{src:""})})}}}]);
//# sourceMappingURL=1.e2811716.chunk.js.map